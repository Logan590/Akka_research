<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consommation Électrique</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Consommation Électrique</h1>
    <div id="chart"></div>

    <script>
        async function loadConsumption() {
            const response = await fetch("/api/consommation");
            const data = await response.json();
            const datasets = data.datasets;

            let timeLabels = [];
            let traces = [];

            datasets.forEach((dataset, index) => {
                let yValues = [];
                dataset.forEach((entry, i) => {
                    let time = Object.keys(entry)[0];
                    let values = Object.values(entry)[0];
                    
                    if (index === 0) {
                        timeLabels.push(time);
                    }
                    
                    yValues.push(values.reduce((a, b) => a + b, 0)); // Somme des consommations
                });

                traces.push({
                    x: timeLabels,
                    y: yValues,
                    mode: "lines",
                    name: `Simulation ${index + 1}`
                });
            });

            Plotly.newPlot("chart", traces, { title: "Courbes de Consommation" });
        }

        loadConsumption();
    </script>
</body>
</html>
